kind: pipeline
name: default

volumes:
  - name: cache
    host:
      path: /tmp/drone/cache

steps:
  - name: restore-cache
    image: drillster/drone-volume-cache
    settings:
      restore: true
      mount:
        - ./node_modules
    volumes:
      - name: cache
        path: /cache
   
  - name: install-dependencies
    image: node
    commands:
      - npm install
   
  - name: save-cache
    image: drillster/drone-volume-cache
    settings:
      rebuild: true
      mount:
       - ./node_modules
    volumes:
      - name: cache
        path: /cache

  - name: test-unit
    image: node
    commands:
      - npm run test

  
  - name: slack
    image: plugins/slack
    settings:
      webhook: 
        from_secret: slack-hook
      channel: dev-status
      template: >
        {{#success build.status}}
          Build {{build.number}} on ${DRONE_BRANCH} succeeded ðŸš€

          Commit: ${DRONE_COMMIT_MESSAGE}  - ${DRONE_COMMIT_AUTHOR}
          ${DRONE_COMMIT_LINK}
          
          Good job ðŸ’ª.
        {{else}}
          Build {{build.number}} on ${DRONE_BRANCH} failed ðŸ˜± 
          Commit: ${DRONE_COMMIT_MESSAGE}  - ${DRONE_COMMIT_AUTHOR}
          ${DRONE_COMMIT_LINK} 

          Following steps have failed: ${DRONE_FAILED_STAGES}
          
          Fix me please ðŸ’‰.
        {{/success}}
